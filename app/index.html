<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>welviv</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <!-- build:css(.tmp) styles/main.css -->
        <link rel="stylesheet" href="styles/main.css">
        <!-- endbuild -->
        <!-- build:js scripts/vendor/modernizr.js -->
        <script src="bower_components/modernizr/modernizr.js"></script>
        <!-- endbuild -->
        <!-- build:js scripts/vendor/jsqrcode.js -->
        <script type="text/javascript" src="scripts/vendor/qr-scan/grid.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/version.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/detector.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/formatinf.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/errorlevel.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/bitmat.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/datablock.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/bmparser.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/datamask.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/rsdecoder.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/gf256poly.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/gf256.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/decoder.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/qrcode.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/findpat.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/alignpat.js"></script>
        <script type="text/javascript" src="scripts/vendor/qr-scan/databr.js"></script>
        <!-- endbuild -->
    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->


        <div class="hero-unit">
          <h1>'Allo, 'Allo!</h1>
          <p>You now have</p>
          <ul>
            <li>HTML5 Boilerplate</li>
            <li>jQuery</li>
            <li>Backbone.js</li>
            <li>Underscore.js</li>
            <li>Modernizr</li>
            <li>RequireJS</li>
          </ul>
        </div>

        <button id="screenshot-button">Scan QR code</button>
        <button id="screenshot-stop-button">Stop</button>
        <video autoplay></video>
        <img src="" id="screenshot">
        <canvas id="qr-canvas" width="640" height="480"></canvas>

        <script type="text/javascript">
            var onFailSoHard = function(e) {
                console.log('Reeeejected!', e);
            };

            function hasGetUserMedia() {
              // Note: Opera builds are unprefixed.
              return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
                        navigator.mozGetUserMedia || navigator.msGetUserMedia);
            }

            if (hasGetUserMedia()) {
                var video = document.querySelector('video');
                var canvas = document.querySelector('canvas');
                var button = document.querySelector('#screenshot-button');
                var img = document.querySelector('#screenshot');
                var ctx = canvas.getContext('2d');
                var localMediaStream = null;

                function sizeCanvas() {
                  // video.onloadedmetadata not firing in Chrome. See crbug.com/110938.
                  setTimeout(function() {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    img.height = video.videoHeight;
                    img.width = video.videoWidth;
                  }, 50);
                }

                function snapshot() {
                  if (localMediaStream) {
                    ctx.drawImage(video, 0, 0);
                    // "image/webp" works in Chrome 18. In other browsers, this will fall back to image/png.
                    document.querySelector('img').src = canvas.toDataURL('image/webp');
                  }
                }


                button.addEventListener('click', function(e) {
                      if (localMediaStream) {
                        snapshot();
                        return;
                      }

                    if (navigator.getUserMedia) {
                        navigator.getUserMedia('video', function(stream) {
                          video.src = stream;
                          localMediaStream = stream;
                          sizeCanvas();
                          button.textContent = 'Take Shot';
                        }, onFailSoHard);
                    } else if (navigator.webkitGetUserMedia) {
                        navigator.webkitGetUserMedia('video', function(stream) {
                          video.src = window.webkitURL.createObjectURL(stream);
                          localMediaStream = stream;
                          sizeCanvas();
                          button.textContent = 'Take Shot';
                        }, onFailSoHard);
                      } else {
                        onFailSoHard({target: video});
                      }
                }, false);

                video.addEventListener('click', snapshot, false);

                document.querySelector('#screenshot-stop-button').addEventListener('click', function(e) {
                  video.pause();
                  localMediaStream.stop(); // Doesn't do anything in Chrome.
                }, false);


            } else {
              alert('getUserMedia() is not supported in your browser');
            }
        </script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>

        <!-- build:js scripts/main.js -->
        <script data-main="scripts/main" src="bower_components/requirejs/require.js"></script>
        <!-- endbuild -->
</body>
</html>
